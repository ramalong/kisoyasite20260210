---
import servicesData from "../../content/services.json";

interface Service {
  id: string;
  title: string;
  summary: string;
  bullets: string[];
  href: string;
  image: string;
}

const services = servicesData as Service[];
import "../../styles/sections/services.css";
---

<section class="section services-section js-services-section" id="services">
  <div class="container services-container">
    <!-- Header: Vertical Title (Leftmost) -->
    <div class="services-header">
      <h2 class="services-title">活動内容</h2>
      <div class="services-decoration"></div>
    </div>

    <!-- Scrollable Text List (Static Grid) -->
    <div class="services-list">
      {
        services.map((s) => {
          // Define color based on ID
          let accentColor = "#edafb8"; // Default (Counseling)
          if (s.id === "learning") accentColor = "#DE802B";
          if (s.id === "expression") accentColor = "#b0c4b1";

          return (
            <div
              class="service-block"
              id={`service-${s.id}`}
              style={`--service-accent: ${accentColor};`}
            >
              <div class="service-row">
                {/* Text Side */}
                <div class="card service-content">
                  <div class="service-header">
                    <div class="service-title">{s.title}</div>
                    <a class="service-btn" href={s.href}>
                      詳細 →
                    </a>
                  </div>
                  <p class="service-summary">{s.summary}</p>
                  <ul class="service-bullets">
                    {s.bullets.map((b) => (
                      <li>{b}</li>
                    ))}
                  </ul>
                </div>

                {/* Image Side */}
                <div class="service-image">
                  <img
                    src={
                      s.image ||
                      `https://placehold.co/600x400/3F9AAE/ffffff?text=${s.title}`
                    }
                    alt={s.title}
                    loading="lazy"
                  />
                </div>
              </div>
            </div>
          );
        })
      }
    </div>
  </div>
</section>

<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  const servicesSection = document.querySelector(".js-services-section");
  if (servicesSection) {
    const header = servicesSection.querySelector(".services-header");
    const blocks = servicesSection.querySelectorAll(".service-block");

    // Header Animation
    gsap.from(header, {
      scrollTrigger: {
        trigger: servicesSection,
        start: "top 75%",
        toggleActions: "play none none reverse",
      },
      x: -30,
      opacity: 0,
      duration: 1,
      ease: "power2.out",
    });

    // Blocks Stagger
    blocks.forEach((block, i) => {
      gsap.from(block, {
        scrollTrigger: {
          trigger: block,
          start: "top 85%",
          toggleActions: "play none none reverse",
        },
        y: 60,
        opacity: 0,
        duration: 0.8,
        delay: i * 0.1, // mild stagger if they appear together, basically per-block trigger
        ease: "power2.out",
      });
    });
  }
</script>
